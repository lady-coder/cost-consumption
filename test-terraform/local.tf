locals {
  mod = path.module
  cwd = path.cwd
}
postgres


2CFtEoo9bJqGozwgzjbX

database-1.cluster-crwrwfmegyrd.eu-west-2.rds.amazonaws.com

 {'Records': [{'messageId': '908581ff-69b0-45f8-8ca9-70ebc3f92dd3', 'receiptHandle': 'AQEBc4w+rG+nx8nPgq4d4C0kxi8trQN0j3zThPhZ1tuHCUxwIhVWpavM0lkY8/OEfRykOOtY4bAfbhOGqqDAdY/xIeQaQmilD8nR72NofBbQjspI6OmlTTeWaM+DmxRYIv0ilFcF5rxk7cI2lGy2dHhTGHASyKwU1yYb8k66zGSmhjMSP7Y8LrMhqMnhzvYzpGjlbj4d4mrX1tpMHs7R9RAnNrPnLNqsY4rkwcjoyB4X7bDudy6yh/3LlEnLWTrnQvTsSA6A9+YHLC4eYco6nYPZIAF1VD7JFItjdisyfTt7wOveIgKlhnVYjYomz1+FT/7fzouZTPEs9BMulNIS0KatE7ht03K53CI/mj3dVn7RwE56aVFl2VFpZP1o1gm2CIa0hffKAGCFr166YyX6r3XHwA==', 'body': '{"GroupDefinitions": [{"Type": "DIMENSION", "Key": "SERVICE"}, {"Type": "TAG", "Key": "Name"}], "ResultsByTime": [{"TimePeriod": {"Start": "2022-04-28", "End": "2022-05-01"}, "Total": {}, "Groups": [{"Keys": ["AWS CloudTrail", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["AWS Key Management Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.4000000032", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Notification Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Queue Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Storage Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.0000831495", "Unit": "USD"}}}, {"Keys": ["AmazonCloudWatch", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}], "Estimated": false}, {"TimePeriod": {"Start": "2022-05-01", "End": "2022-06-01"}, "Total": {}, "Groups": [{"Keys": ["AWS CloudTrail", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["AWS Config", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.009", "Unit": "USD"}}}, {"Keys": ["AWS Key Management Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "3.983870904", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Notification Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Queue Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Storage Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.0008653069", "Unit": "USD"}}}, {"Keys": ["AmazonCloudWatch", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Tax", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.8", "Unit": "USD"}}}], "Estimated": false}, {"TimePeriod": {"Start": "2022-06-01", "End": "2022-07-01"}, "Total": {}, "Groups": [{"Keys": ["AWS CloudTrail", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["AWS Config", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.033", "Unit": "USD"}}}, {"Keys": ["AWS Key Management Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "3.9805555874", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Notification Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Queue Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Storage Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.000834326", "Unit": "USD"}}}, {"Keys": ["AmazonCloudWatch", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Tax", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.81", "Unit": "USD"}}}], "Estimated": false}, {"TimePeriod": {"Start": "2022-07-01", "End": "2022-07-28"}, "Total": {}, "Groups": [{"Keys": ["AWS CloudTrail", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["AWS Config", "Name$"], "Metrics": {"BlendedCost": {"Amount": "1.248", "Unit": "USD"}}}, {"Keys": ["AWS Cost Explorer", "Name$"], "Metrics": {"BlendedCost": {"Amount": "1.04", "Unit": "USD"}}}, {"Keys": ["AWS Key Management Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "3.408602096", "Unit": "USD"}}}, {"Keys": ["AWS Lambda", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.0000047374", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Notification Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Queue Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Amazon Simple Storage Service", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0.0010907405", "Unit": "USD"}}}, {"Keys": ["AmazonCloudWatch", "Name$"], "Metrics": {"BlendedCost": {"Amount": "0", "Unit": "USD"}}}, {"Keys": ["Tax", "Name$"], "Metrics": {"BlendedCost": {"Amount": "1.14", "Unit": "USD"}}}], "Estimated": true}], "DimensionValueAttributes": [], "ResponseMetadata": {"RequestId": "f3d82a62-06d9-4b10-880b-08c50b9bfa16", "HTTPStatusCode": 200, "HTTPHeaders": {"date": "Thu, 28 Jul 2022 07:38:35 GMT", "content-type": "application/x-amz-json-1.1", "content-length": "3723", "connection": "keep-alive", "x-amzn-requestid": "f3d82a62-06d9-4b10-880b-08c50b9bfa16", "cache-control": "no-cache"}, "RetryAttempts": 0}}', 'attributes': {'ApproximateReceiveCount': '1', 'SentTimestamp': '1658993916694', 'SenderId': 'AROAXBOUKKDHMJVVBFBAE:dev-client-report-generator', 'ApproximateFirstReceiveTimestamp': '1658993916698'}, 'messageAttributes': {}, 'md5OfBody': '3758433d0124319206b41cdfc7ee171a', 'eventSource': 'aws:sqs', 'eventSourceARN': 'arn:aws:sqs:eu-west-2:484165963982:dev-report-delivery-queue', 'awsRegion': 'eu-west-2'}]}

CREATE TABLE public.customer (
	client_id SERIAL UNIQUE,
	client_name varchar NOT NULL,
	project varchar NOT NULL,
	environment varchar NOT NULL,
	total_aws_accounts int4 NOT NULL,
	description varchar NULL,
	CONSTRAINT customer_un UNIQUE (client_name, project)
);

CREATE TABLE public.services (
	service_id SERIAL UNIQUE,
	client_id int8 not NULL,
	aws_services varchar NULL,
	time_period_start date NOT NULL,
	time_period_end date NOT NULL,
	value numeric(5,2) NOT NULL,
	additional_comments varchar NULL,
	CONSTRAINT customer_service_fk foreign key (client_id) references public.customer(client_id)
); 

CREATE TABLE public.forecast (
	forecast_id SERIAL UNIQUE,
	client_id int8 not NULL,
	time_period_start date NOT NULL,
	time_period_end date NOT NULL,
	amount numeric(5,2) NOT NULL,
	additional_comments varchar NULL,
	CONSTRAINT customer_forecast_fk foreign key (client_id) references public.customer(client_id),
	CONSTRAINT forecast_un UNIQUE (client_id, time_period_start,time_period_end)
);